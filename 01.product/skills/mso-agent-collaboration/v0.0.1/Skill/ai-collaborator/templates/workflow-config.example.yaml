# workflow-config.yaml — 프로젝트별 멀티에이전트 오케스트레이션 설정
# 이 파일을 프로젝트 루트에 workflow-config.yaml로 복사한 뒤 값을 채운다.
# SKILL.md의 Configuration 섹션 참조.

# ─── 프로젝트 메타 ──────────────────────────────────────────────
project:
  name: "my-project"                     # 프로젝트 식별자
  root: "."                              # 프로젝트 루트 경로

# ─── 역할별 경로 제한 ───────────────────────────────────────────
roles:
  planner:
    allowed_paths:
      - "docs/**"                        # 기획/문서만 수정 가능
      - "config/**"
    read_only: false

  worker:
    allowed_paths:
      - "src/**"                         # 소스 코드
      - "tests/**"                       # 테스트 코드
      # 예: "03.scripts/**" (프로젝트에 맞게 수정)
    read_only: false

  reviewer:
    allowed_paths:
      - "**/*"                           # 전체 읽기 가능
    read_only: true                      # 수정 불가

  merge_agent:
    allowed_paths:
      - "**/*"                           # 병합 시 전체 접근
    read_only: false

# ─── 병렬 실행 제한 ─────────────────────────────────────────────
concurrency:
  max_parallel_workers: 3                # 동시 Worker 최대 수
  task_timeout_seconds: 300              # 태스크 기본 타임아웃
  max_retries: 2                         # 태스크당 최대 재시도

# ─── 명령 보안 ──────────────────────────────────────────────────
commands:
  denylist:
    - "rm -rf"
    - "git reset --hard"
    - "git push --force"
    - "DROP TABLE"
    - "DROP DATABASE"
    # 프로젝트별 추가 금지 명령:
    # - "직접 DB 연결 명령"

  allowlist: []
  # allowlist가 비어있으면 denylist 모드 (denylist 외 모두 허용)
  # allowlist에 항목이 있으면 allowlist 모드 (allowlist만 허용)

# ─── 품질 게이트 ────────────────────────────────────────────────
quality_gates:
  - gate: lint
    command: "echo 'lint command here'"   # 프로젝트 lint 명령으로 교체
    threshold: 0                          # 허용 경고 수 (0 = 경고 없어야 통과)
    required: true

  - gate: test
    command: "echo 'test command here'"   # 프로젝트 테스트 명령으로 교체
    threshold: 100                        # 최소 통과율 (%)
    required: true

  - gate: policy_check
    command: "echo 'policy check here'"   # 정책 검증 명령
    rules: []
    # 프로젝트별 정책 규칙 예시:
    # - name: "no-pii-access"
    #   pattern: "chat_message|\.env"
    #   action: "block"
    # - name: "no-raw-data"
    #   pattern: "consultData\.db.*content"
    #   action: "block"
    required: true

  - gate: human_approve
    required: false                       # true로 변경 시 사람 승인 필수

# ─── 관찰성 지표 ────────────────────────────────────────────────
observability:
  log_format: "jsonl"                    # 로그 포맷: jsonl | json | text
  log_dir: "logs/"                       # 로그 출력 디렉토리
  metrics:
    - success_rate                       # 성공률
    - avg_duration_seconds               # 평균 처리시간
    - retry_rate                         # 재시도율
    - conflict_rate                      # 충돌률
    - total_tokens                       # 총 토큰 사용량

# ─── 드리프트 방지 ──────────────────────────────────────────────
drift_prevention:
  rules_hash_check: true                 # 실행 시작 시 시스템 규칙 해시 검증
  config_hash_check: true                # 실행 시작 시 설정 파일 해시 검증
  context_summary_max_lines: 5           # 단계 간 전달 요약 최대 줄 수
  immutable_during_run: true             # 실행 중 설정 변경 금지

# ─── 모델 전략 (선택) ───────────────────────────────────────────
model_strategy:
  planning: "high"                       # 분해/초안: high | medium | low
  execution: "medium"                    # 실행: 중간 비용 모델
  review: "high"                         # 검증: 고비용 모델
  # 실제 모델 ID는 에이전트 런타임에서 매핑

# ─── episodic-memory 연동 (선택) ────────────────────────────────
episodic_memory:
  enabled: false                         # true로 변경 시 활성화
  db_path: "~/.episodic-memory/conversations.db"
  search_triggers:
    - "설계 결정 전"
    - "과거 참조 시"
