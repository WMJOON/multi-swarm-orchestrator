{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "task-handoff.schema.json",
  "title": "Task Handoff",
  "description": "Planner -> Worker 태스크 할당 구조. 역할, 경로 제한, 의존성 등을 포함한다.",
  "type": "object",
  "required": [
    "run_id",
    "task_id",
    "phase",
    "owner_agent",
    "role",
    "objective",
    "allowed_paths",
    "constraints"
  ],
  "properties": {
    "run_id": {
      "type": "string",
      "pattern": "^run-[0-9]{8}-[a-z0-9]{6}$",
      "description": "실행 단위 고유 ID (예: run-20260211-a1b2c3)"
    },
    "task_id": {
      "type": "string",
      "pattern": "^task-[0-9]{3,}$",
      "description": "태스크 고유 ID (예: task-001)"
    },
    "phase": {
      "type": "string",
      "enum": ["planning", "execution", "review", "merge", "close"],
      "description": "현재 워크플로우 단계"
    },
    "owner_agent": {
      "type": "string",
      "minLength": 1,
      "description": "태스크를 수행할 에이전트 식별자"
    },
    "role": {
      "type": "string",
      "enum": ["planner", "worker", "reviewer", "merge_agent"],
      "description": "에이전트 역할"
    },
    "objective": {
      "type": "string",
      "minLength": 10,
      "description": "수행할 작업의 명확한 목표 (최소 10자)"
    },
    "allowed_paths": {
      "type": "array",
      "items": { "type": "string" },
      "minItems": 1,
      "description": "수정 허용 경로 glob 패턴 목록"
    },
    "constraints": {
      "type": "object",
      "properties": {
        "read_only": {
          "type": "boolean",
          "default": false,
          "description": "true이면 파일 수정 불가 (Reviewer용)"
        },
        "max_files": {
          "type": "integer",
          "minimum": 1,
          "description": "수정 가능한 최대 파일 수"
        },
        "command_denylist": {
          "type": "array",
          "items": { "type": "string" },
          "description": "실행 금지 명령 목록"
        },
        "command_allowlist": {
          "type": "array",
          "items": { "type": "string" },
          "description": "실행 허용 명령 목록 (설정 시 이외 모두 차단)"
        }
      },
      "additionalProperties": false
    },
    "context_summary": {
      "type": "string",
      "maxLength": 500,
      "description": "이전 단계의 핵심 사실 요약 (최대 5줄, 500자)"
    },
    "depends_on": {
      "type": "array",
      "items": { "type": "string" },
      "description": "선행 완료 필요 task_id 목록"
    },
    "timeout_seconds": {
      "type": "integer",
      "minimum": 30,
      "maximum": 3600,
      "default": 300,
      "description": "태스크 타임아웃 (초)"
    }
  },
  "additionalProperties": false
}